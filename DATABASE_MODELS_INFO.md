# Информационная таблица по моделям базы данных

Ниже собрана сводка по моделям, которые участвуют в миграциях БД через GORM (`initModels`).

## 1) `model.User` (таблица `users`)

| Колонка | Информация (что хранится, для чего, как используется) | Используется ли в проекте (где) |
|---|---|---|
| `id` | Первичный ключ пользователя (администратор/оператор панели). Используется для идентификации записи пользователя. | Да: миграции, создание дефолтного пользователя, чтение/обновление в user/setting сервисах. |
| `username` | Логин пользователя панели. Нужен для входа и поиска пользователя при авторизации. | Да: проверка при логине и операции управления пользователем. |
| `password` | Хэш пароля пользователя (bcrypt после сидера). Используется для аутентификации. | Да: сидер мигрирует старые пароли в bcrypt, далее сравнение при входе и обновление. |

Примеры использования: `database/db.go`, `web/service/user.go`, `web/service/setting.go`, `web/session/session.go`.

## 2) `model.Inbound` (таблица `inbounds`)

| Колонка | Информация (что хранится, для чего, как используется) | Используется ли в проекте (где) |
|---|---|---|
| `id` | PK inbound-конфигурации Xray. | Да: CRUD inbound, связи с клиентским трафиком. |
| `user_id` | Владелец inbound (связь с пользователем панели). | Да: выборка inbound по пользователю. |
| `up` / `down` | Накопленный входящий/исходящий трафик inbound. | Да: обновление статистики в фоновых задачах и сервисах. |
| `total` | Лимит общего трафика inbound. | Да: контроль лимитов и логика авто-отключения. |
| `all_time` | Общий трафик за всё время. | Да: отображение и расчёты лимитов. |
| `remark` | Человекочитаемое название/комментарий inbound. | Да: UI/поиск/Telegram-уведомления. |
| `enable` | Флаг активности inbound. | Да: фильтрация активных inbound и переключение состояния. |
| `expiry_time` | Unix-время истечения inbound. | Да: проверки истечения, авто-обновления статуса. |
| `traffic_reset` | Период/режим сброса трафика (`never`, и т.д.). | Да: jobs периодического сброса. |
| `last_traffic_reset_time` | Время последнего сброса трафика. | Да: контроль следующего сброса. |
| `clientStats` (связь) | Связанные записи `xray.ClientTraffic` по `inbound_id`. | Да: `Preload("ClientStats")` при чтении inbound. |
| `listen` | Адрес bind для inbound Xray. | Да: генерация runtime-конфига Xray. |
| `port` | Порт inbound. | Да: проверки уникальности/коллизий, генерация конфига. |
| `protocol` | Протокол (`vmess`, `vless`, `trojan` и др.). | Да: бизнес-логика в inbound сервисе. |
| `settings` | JSON-настройки inbound и клиентов (в т.ч. лимиты/expiry/email). | Да: парсинг/обновление клиентов, поиск по email/параметрам. |
| `stream_settings` | JSON stream-настройки транспорта. | Да: обновления транспорта и генерация Xray-конфига. |
| `tag` | Уникальный тег inbound в Xray. | Да: маршрутизация, сопоставление статистики и конфигов. |
| `sniffing` | JSON-настройки sniffing. | Да: часть runtime-конфига Xray. |

Примеры использования: `web/service/inbound.go`, `web/controller/inbound.go`, `web/job/check_client_ip_job.go`, `web/service/tgbot.go`.

## 3) `model.OutboundTraffics` (таблица `outbound_traffics`)

| Колонка | Информация (что хранится, для чего, как используется) | Используется ли в проекте (где) |
|---|---|---|
| `id` | PK записи outbound-трафика. | Да: хранение и обновление статистики. |
| `tag` | Уникальный outbound tag из Xray. | Да: upsert/поиск статистики по tag. |
| `up` / `down` | Аплоад/даунлоад outbound-трафика. | Да: периодическое накопление данных из Xray API. |
| `total` | Совокупный объём трафика outbound. | Да: отображение в UI/API. |

Примеры использования: `web/service/outbound.go`.

## 4) `model.Setting` (таблица `settings`)

| Колонка | Информация (что хранится, для чего, как используется) | Используется ли в проекте (где) |
|---|---|---|
| `id` | PK настройки. | Да: базовый идентификатор записи. |
| `key` | Имя настройки (например, ключи Telegram, Xray, UI-параметры и т.д.). | Да: чтение/запись конфигурации панели по ключам. |
| `value` | Значение настройки (обычно строка/JSON в строке). | Да: инициализация и работа сервисов/джобов. |

Примеры использования: `web/service/setting.go`, `web/controller/setting.go`, `web/job/check_client_ip_job.go`.

## 5) `model.InboundClientIps` (таблица `inbound_client_ips`)

| Колонка | Информация (что хранится, для чего, как используется) | Используется ли в проекте (где) |
|---|---|---|
| `id` | PK записи ограничений по IP клиента. | Да: создание/обновление списка IP. |
| `client_email` | Уникальный идентификатор клиента (email из inbound settings). | Да: поиск и привязка IP-истории к клиенту. |
| `ips` | Сериализованный список IP/временных меток. Нужен для anti-sharing и лимитов IP. | Да: job проверки IP клиентов + inbound service. |

Примеры использования: `web/job/check_client_ip_job.go`, `web/service/inbound.go`.

## 6) `xray.ClientTraffic` (таблица `client_traffics`)

| Колонка | Информация (что хранится, для чего, как используется) | Используется ли в проекте (где) |
|---|---|---|
| `id` | PK записи трафика клиента. | Да: CRUD/сброс/обновление статистики. |
| `inbound_id` | Внешняя связь с `inbounds.id`. | Да: выборки клиентского трафика в рамках inbound. |
| `enable` | Флаг активности клиента. | Да: синхронизация состояния клиента. |
| `email` | Уникальный email клиента. | Да: основной ключ в бизнес-операциях (поиск/сброс/обновление). |
| `uuid` | UUID клиента, **не хранится в БД** (`gorm:"-"`), используется как runtime-поле. | Частично: участвует в логике на уровне структур, но не мигрируется в таблицу. |
| `subId` | Subscription ID, **не хранится в БД** (`gorm:"-"`). | Частично: runtime/JSON-поле, не колонка SQL. |
| `up` / `down` | Трафик клиента (upload/download). | Да: обновляется из статистики Xray. |
| `all_time` | Трафик клиента за всё время. | Да: расчёты и отображение лимитов. |
| `expiry_time` | Срок действия клиента. | Да: отключение/уведомления/валидация. |
| `total` | Лимит клиента по трафику. | Да: контроль исчерпания лимита. |
| `reset` | Период сброса трафика клиента. | Да: периодические jobs сброса. |
| `last_online` | Последнее время активности клиента. | Да: отчётность/мониторинг активности. |

Примеры использования: `web/service/inbound.go`, `web/controller/inbound.go`, `web/job/xray_traffic_job.go`, `web/service/tgbot.go`.

## 7) `model.HistoryOfSeeders` (таблица `history_of_seeders`)

| Колонка | Информация (что хранится, для чего, как используется) | Используется ли в проекте (где) |
|---|---|---|
| `id` | PK записи истории сидеров. | Да: техучёт применённых сидеров. |
| `seeder_name` | Имя применённого сидера (например, `UserPasswordHash`). | Да: защита от повторного запуска сидера миграции паролей. |

Примеры использования: `database/db.go`.

---

## Примечание

`model.Client` в `database/model/model.go` используется как структура клиентов внутри JSON-поля `Inbound.settings`, но не участвует в `AutoMigrate`, то есть отдельной SQL-таблицей не является.
